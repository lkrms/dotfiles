#!/usr/bin/env bash

. "$df_root/bin/lib/bash-helpers.sh" || exit

file=$(find_first credentials-config.json) || exit 1
replace=${file%credentials-config.json}files/workspace6/General/.dbeaver/credentials-config.json

backup_file "$replace"
replace_file "$replace" < <(
    {
        printf '0123456789abcdef'
        jq -c <"$file"
    } | openssl aes-128-cbc -K babb4a9f774ab853c96c2d653dfe544a -iv 00000000000000000000000000000000
)

type -P md5sum >/dev/null || exit 0

IFS=$'\n' read -d '' -ra delete < <(
    md5sum "$replace".bak-[0-9][0-9][0-9] |
        awk 'seen[$1]++ {print $2}'
    printf '\0'
)
maybe rm -fv -- ${delete+"${delete[@]}"}
